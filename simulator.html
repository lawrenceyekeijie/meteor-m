<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Asteroid Simulator ğŸ›°ï¸</title>
  <link rel="stylesheet" href="style.css">
  <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css"/>
</head>
<body>
  <header>Meteor Madness ğŸš€</header>
  <nav>
    <a href="index.html">Home</a>
    <a href="simulator.html">Simulator</a>
    <a href="quiz.html">Quiz</a>
    <a href="history.html">History</a>
  </nav>

  <section>
    <h2>ğŸŒŒ Choose a Real Asteroid (NASA NEO API)</h2>
    <select id="asteroidList" onchange="loadAsteroidData(this.value)">
      <option value="">-- Loading from NASA API... --</option>
    </select>
    <div id="asteroidInfo"></div>
  </section>

  <section>
    <h2>ğŸ›°ï¸ Custom Impact Simulation</h2>
    <label>Size (m): <input id="size" type="number" value="100"></label>
    <label>Speed (km/s): <input id="speed" type="number" value="20"></label>
    <button onclick="simulateImpact()">Simulate</button>
    <div id="output"></div>
  </section>

  <section>
    <h2>ğŸ—ºï¸ Pick Impact Location</h2>
    <p>Click anywhere on the map to set the asteroid impact point.</p>
    <div id="map"></div>
  </section>

  <section>
    <h2>ğŸ›¡ï¸ Mini Game: Defend Earth</h2>
    <button onclick="startDefense()">Start Defense Challenge</button>
    <div id="game"></div>
  </section>

  <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
  <script>
    // ========== NASA API ==========
    const apiKey = "DEMO_KEY"; // ğŸ‘‰ å»ºè®®å» https://api.nasa.gov/ æ¢æˆä½ è‡ªå·±çš„ key
    const asteroidList = document.getElementById("asteroidList");
    const asteroidInfo = document.getElementById("asteroidInfo");

    fetch(`https://api.nasa.gov/neo/rest/v1/neo/browse?api_key=${apiKey}`)
      .then(res => res.json())
      .then(data => {
        asteroidList.innerHTML = '<option value="">-- Select an asteroid --</option>';
        data.near_earth_objects.slice(0,10).forEach(asteroid => {
          let option = document.createElement("option");
          option.value = JSON.stringify({
            name: asteroid.name,
            size: asteroid.estimated_diameter.meters.estimated_diameter_max.toFixed(0),
            speed: (asteroid.close_approach_data[0]?.relative_velocity.kilometers_per_second || 20).toFixed(1)
          });
          option.textContent = asteroid.name;
          asteroidList.appendChild(option);
        });
      });

    function loadAsteroidData(val) {
      if (!val) return;
      let a = JSON.parse(val);
      document.getElementById("size").value = a.size;
      document.getElementById("speed").value = a.speed;
      asteroidInfo.innerHTML = `ğŸŒ‘ <b>${a.name}</b><br>Size: ${a.size} m<br>Speed: ${a.speed} km/s`;
    }

    // ========== Map ==========
    var map = L.map('map').setView([20,0], 2);
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
      attribution: '&copy; OpenStreetMap contributors'
    }).addTo(map);
    var marker;
    var impactCoords = [0,0];

    map.on('click', function(e) {
      if (marker) map.removeLayer(marker);
      marker = L.marker(e.latlng).addTo(map).bindPopup("Impact Point").openPopup();
      impactCoords = [e.latlng.lat, e.latlng.lng];
    });

    // ========== Simulation ==========
    function simulateImpact() {
      let size = document.getElementById("size").value;
      let speed = document.getElementById("speed").value;
      // ç²—ç•¥èƒ½é‡è®¡ç®— (TNT å½“é‡)
      let energy = (0.5 * (4/3*Math.PI*(size/2)**3 * 3000) * (speed*1000)**2) / 4.184e15;
      document.getElementById("output").innerHTML =
        `ğŸ’¥ Estimated Impact Energy: ${energy.toExponential(2)} tons TNT` +
        `<br>ğŸŒ Location: ${impactCoords[0].toFixed(2)}, ${impactCoords[1].toFixed(2)}` +
        `<br>âš ï¸ Possible Effects: Crater ~ ${(size/2).toFixed(0)} m, Global shockwave risk.`;
    }

    // ========== Mini Game ==========
    function startDefense() {
      const defenses = ["ğŸš€ Kinetic Impact", "ğŸ”¦ Laser Beam", "ğŸ›°ï¸ Gravity Tractor"];
      let choice = defenses[Math.floor(Math.random()*defenses.length)];
      let success = Math.random() > 0.5 ? "âœ… Earth Saved!" : "ğŸ’€ Mission Failed!";
      document.getElementById("game").innerHTML =
        `You chose: <b>${choice}</b><br>Result: ${success}`;
    }
  </script>
</body>
</html>

